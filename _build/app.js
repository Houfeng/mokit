/*csd*/define(function(require,exports,module){"use strict";exports.mokit={version:"2.0 Beta 24",author:"Houfeng"};var d=require("./console"),l=require("./route"),g=require("./event"),o=require("./utils"),i=require("./model"),p=require("./view"),e=require("./controller"),h=require("./language"),m=require("./style"),b=require("./ajax"),n=require("./transitions"),j=require("./navigation");exports.route=l;exports.language=h;exports.style=m;exports.console=d;exports.utils=o;exports.model=i;exports.view=p;exports.controller=e;exports.ajax=b;exports.onstart=g.create(exports,"onStart");var k=function(q){var r={"route":q};exports.onStart.trigger(r);return !r.cancel;};var f=null;var c=function(t,q,s){if(f){t.route.effect=t.route.effect||[0,0];var r=(s&&f)?f.route.effect[1]:t.route.effect[0];n.change(f.rootView,t.rootView,r,function(){f.rootView.remove();f.rootView=null;delete f.rootView;f=null;f=t;if(q){q();}},{container:p.rootContainer});}else{f=t;if(q){q();}}};var a=function(s,q){if(n.isAnimating()){return;}var r=l.getRoute(s);if(!r){return d.error(s+" not found");}if(!k(r)){return;}require(r.target,function(t){var u=new t();u.route=r;u.routeData=r.routeData;u.setView=function(x,v){var w=this;x.root=x;w.rootView=x;if(!w.rootView){return d.error(s+" rootView not found");}w.rootView.controller=w;w.rootView.render(null,function(){c(w,v,q);});};if(u.index){u.index({"routeData":u.routeData});}});};j.change(function(r,q){if(r){a(r,q);}});exports.start=function(q){if(q!=j.getUri()){j.setUri(q);}else{a(q);}};exports.back=j.back;exports.init=function(q){q=q||{};q.style=q.style||m.currentName()||"default";q.language=q.language||h.currentName()||"zh-cn";m.setStyle(q.style);h.setLanguage(q.language,function(){exports.start(j.getUri()||q.index);});};});