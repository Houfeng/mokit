/*csd*/define(function(require,exports,module){"use strict";var a=require("./jquery"),g=require("./utils"),f=require("./store"),e=require("./mask");exports.loadingOption=null;window.top.__mokit_ajax_filters__=window.top.__mokit_ajax_filters__||[];window.top.__mokit_ajax_setup__=window.top.__mokit_ajax_setup__||{};var b=f.dataCache;var c=window.top.__mokit_ajax_filters__;var d=function(i,h){g.each(c,function(){if(this!=null&&this[i]){h=this[i](h);}});return h;};exports.addDataFilter=function(h){c.push(h);};exports.setup=function(h){a.ajaxSetup(h);};exports.request=function(j){j=j||{};if(!j.noMask){e.begin(exports.loadingOption);}if(exports.onBegin){exports.onBegin();}j.url=j.url||"";var h="mokit://ajax/"+j.url;b[h]=b[h]||{};j.url=g.wrapUrl(j.url);j.type=j.type||"GET";j.dataType=j.dataType||"json";j.success=j.success||j.callback;j.data=d("send",j.data);if(j.success&&j.cacheEnabled&&b[h].result!=null){e.end(exports.loadingOption);j.success(b[h].result);return;}var k=j.success;j.success=b[h].success=function(l){l=d("receive",l);if(j.cacheEnabled){b[h].result=l;}if(k){k(l);}if(exports.onEnd){exports.onEnd();}if(!j.noMask){e.end(exports.loadingOption);}};var i=j.error;j.error=function(){if(!j.noMask){e.end(exports.loadingOption);}if(i){i(arguments);}};b[h].xhr=a.ajax(j);return b[h].xhr;};exports.get=function(h){h.type="GET";return exports.request(h);};exports.post=function(h){h.type="POST";return exports.request(h);};exports.abort=function(i){if(i){var h="mokit://ajax/"+i;b[h].success=null;b[h].abort();}else{g.each(b,function(k,j){j.success=null;j.abort();});}e.end(exports.loadingOption);};});