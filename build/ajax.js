/*csd*/define(function(require,exports,module){"use strict";var a=require("./jquery");var i=require("./utils");var g=require("./store");var e=require("./mask");var f=exports;var h=window.top;f.loadingOption=null;h.__mokit_ajax_filters__=h.__mokit_ajax_filters__||[];h.__mokit_ajax_setup__=h.__mokit_ajax_setup__||{};var b=g.dataCache;var c=h.__mokit_ajax_filters__;var d=function(k,j){i.each(c,function(){if(this!=null&&this[k]){j=this[k](j);}});return j;};f.addDataFilter=function(j){c.push(j);};f.setup=function(j){a.ajaxSetup(j);};f.request=function(l){l=l||{};if(!l.noMask){e.begin(f.loadingOption);}if(f.onBegin){f.onBegin();}l.url=l.url||"";var j="mokit://ajax/"+l.url;b[j]=b[j]||{};l.url=i.wrapUrl(l.url);l.type=l.type||"GET";l.dataType=l.dataType||"json";l.success=l.success||l.callback;l.data=d("send",l.data);if(l.success&&l.cacheEnabled&&b[j].result!=null){e.end(f.loadingOption);l.success(b[j].result);return;}var m=l.success;l.success=b[j].success=function(n){n=d("receive",n);if(l.cacheEnabled){b[j].result=n;}if(m){m(n);}if(f.onEnd){f.onEnd();}if(!l.noMask){e.end(f.loadingOption);}};var k=l.error;l.error=function(){if(!l.noMask){e.end(f.loadingOption);}if(k){k(arguments);}};b[j].xhr=a.ajax(l);return b[j].xhr;};f.get=function(j){j.type="GET";return f.request(j);};f.post=function(j){j.type="POST";return f.request(j);};f.abort=function(k){if(k){var j="mokit://ajax/"+k;b[j].success=null;b[j].xhr.abort();}else{i.each(b,function(m,l){l.success=null;l.xhr.abort();});}e.end(f.loadingOption);};});