/*csd*/define(function(require,exports,module){"use strict";window.mokit=exports.mokit={version:"2.0 Beta 48",author:"Houfeng"};var n=require("./style.css");var f=require("./console");var m=require("./route");var b=require("./event");var q=require("./utils");var j=require("./model");var r=require("./view");var g=require("./controller");var i=require("./language");var n=require("./style");var d=require("./ajax");var p=require("./transitions");var a=require("./jquery");var o=require("./task");var k=require("./navigation");exports.route=m;exports.language=i;exports.style=n;exports.console=f;exports.utils=q;exports.model=j;exports.view=r;exports.controller=g;exports.ajax=d;exports.events=b.use(exports);var l=function(s){var t={"route":s};exports.events.call("onStart",t);return !t.cancel;};var h=null;var e=function(v,s,u){if(h){v.route.effect=v.route.effect||[0,0];var t=(u&&h)?h.route.effect[1]:v.route.effect[0];p.change(h.rootView,v.rootView,t,function(){h.rootView.remove();h.rootView=null;delete h.rootView;h=null;h=v;if(s){s();}},{container:r.rootContainer});}else{h=v;if(s){s();}}};var c=function(u,s){if(p.isAnimating()){return;}var t=m.getRoute(u);if(!t){return f.error('route "'+u+'" not found');}if(!l(t)){return;}require(t.target,function(v){var w=new v();w.route=t;w.routeData=t.routeData;w.setView=function(z,x){var y=this;z.root=z;y.rootView=z;if(!y.rootView){return f.error(u+" rootView not found");}y.rootView.controller=y;y.rootView.render(null,function(){e(y,x,s);});};if(w.index){w.index({"routeData":w.routeData});}});};k.events.on("change",function(s){if(s.uri){c(s.uri,s.isBack);}});exports.start=function(s){if(s!=k.getUri()){k.setUri(s);}else{c(s);}};exports.back=k.back;exports.onReady=function(s){a(s);};exports.init=function(u){u=u||{};u.style=(u.style||n.currentName()||n.defaultName()||"default").toLowerCase();u.language=(u.language||i.currentName()||i.defaultName()||"en-us").toLowerCase();var t=k.getUri();window.navigation=k;if(t==null||t==u.splash){t=u.index;}var s=function(){i.setLanguage(u.language,function(){exports.start(t||u.index);});};var v=function(){if(u.preInit){u.preInit(s);}else{s();}};n.setStyle(u.style,function(){exports.onReady(function(){if(u.splash){exports.start(u.splash);q.async(v,500);}else{v();}});});};});