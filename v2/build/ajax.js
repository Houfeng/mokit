/*csd*/define(function(require,exports,module){"use strict";var a=require("./jquery");var i=require("./utils");var g=require("./store");var e=require("./mask");var f=exports;var h=window.top;f.loadingOption=null;h.mokit=h.mokit||{};h.mokit.ajaxFilters=h.mokit.ajaxFilters||[];var b=g.dataCache;var c=h.mokit.ajaxFilters;var d=function(k,j){i.each(c,function(){if(this!=null&&this[k]){j=this[k](j);}});return j;};f.addDataFilter=function(j){c.push(j);};f.option={};f.setup=function(j){f.option=j||{};a.ajaxSetup(f.option);};f.request=function(k){k=k||{};if(!k.noMask){e.begin(f.loadingOption);}if(f.onBegin){f.onBegin();}k.$timeout=k.$timeout||f.option.$timeout||null;k.url=k.url||"";k.url=i.wrapUrl(k.url);k.type=k.type||"GET";k.dataType=k.dataType||"json";k.success=k.success||k.callback;k.errorArgs={code:500,message:"请求发生错误"};k.data=d("send",k.data);var l=k.success;k.success=function(m){if(k.aborted){return;}k._cleartTimer();m=d("receive",m);if(l){l(m,null);}if(f.onEnd){f.onEnd();}if(!k.noMask){e.end(f.loadingOption);}};var j=k.error||f.option.error;k.error=function(){if(k.aborted){return;}k._cleartTimer();if(j){j(arguments);}else{if(l){l(null,k.errorArgs);}}if(!k.noMask){e.end(f.loadingOption);}};k.abort=function(){k._cleartTimer();k.errorArgs.message="请求被取消";k.aborted=true;if(k.xhr){k.xhr.abort();}if(!k.noMask){e.end(f.loadingOption);}};k._createTimer=function(){if(!k.$timeout){return;}k._timer=setTimeout(function(){if(k._timerCanceled||k._timer==null){return;}k.abort();k.errorArgs.message="请求超时";if(l){l(null,k.errorArgs);}if(j){j(k.errorArgs);}k._cleartTimer();},k.$timeout);};k._cleartTimer=function(){if(k._timer){clearTimeout(k._timer);}k._timer=null;k._timerCanceled=true;};k._createTimer();k.xhr=a.ajax(k);return k;};f.get=function(j){j.type="GET";return f.request(j);};f.post=function(j){j.type="POST";return f.request(j);};});