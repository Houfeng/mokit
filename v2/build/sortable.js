/*csd*/define(function(require,exports,module){"use strict";var a=require("./jquery");var j=require("./touch");var e=exports;var f=null;var c=null;var i=null;var h=null;var b=null;var d={x:30,y:30};var g=null;a(document.body).bind("vmousedown",function(k){i={x:k.pageX,y:k.pageY};}).bind("vmousemove",function(k){if(!f||!c||!i||!h||!b){return;}var l={left:h.left+k.pageX-i.x,top:h.top+k.pageY-i.y};c.css({"left":l.left,"top":l.top});f.each(function(){if(this==c[0]||this==b[0]){return;}var m=a(this);var n=m.offset();if(l.left>n.left-d.x&&l.left<n.left+d.x&&l.top>n.top-d.y&&l.top<n.top+d.y){b.remove();if(l.left<n.left||l.top<n.top){m.before(b);}else{m.after(b);}}});}).bind("vmouseup",function(k){if(!c||!b){return;}c.css({"position":"","left":"","top":"","zIndex":0});b.replaceWith(c);if(g&&g.onEnd){g.onEnd(c);}c=null;i=null;h=null;b=null;f=null;g=null;});e.use=function(k,l){k.attr("draggable",false);k.find("a,img").attr("draggable",false);l=l||{};l.event=l.event||"vmousedown";k.bind(l.event,function(m){g=l;f=k;c=a(this);d={x:c.outerWidth()/5,y:c.outerHeight()/5};h=c.offset();if(b){b.remove();}b=c.clone();b.width(h.width).height(h.height);b.css({"backgroundColor":"#eee","solid":"solid 1px #aaa;"}).html("");c.css({"position":"absolute","zIndex":99999,"left":h.left,"top":h.top});c.before(b);if(l.onBegin){l.onBegin(c);}});};});