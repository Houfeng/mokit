<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/event.js - Mokit API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../logo.png" title="Mokit API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: v2.0 Beta 34</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Ajax.html">Ajax</a></li>
            
                <li><a href="../classes/App.html">App</a></li>
            
                <li><a href="../classes/Base64.html">Base64</a></li>
            
                <li><a href="../classes/Class.html">Class</a></li>
            
                <li><a href="../classes/Console.html">Console</a></li>
            
                <li><a href="../classes/Context.html">Context</a></li>
            
                <li><a href="../classes/Controller.html">Controller</a></li>
            
                <li><a href="../classes/Event.html">Event</a></li>
            
                <li><a href="../classes/Grid.html">Grid</a></li>
            
                <li><a href="../classes/Json.html">Json</a></li>
            
                <li><a href="../classes/Language.html">Language</a></li>
            
                <li><a href="../classes/Mask.html">Mask</a></li>
            
                <li><a href="../classes/Model.html">Model</a></li>
            
                <li><a href="../classes/Move.html">Move</a></li>
            
                <li><a href="../classes/Navigation.html">Navigation</a></li>
            
                <li><a href="../classes/Route.html">Route</a></li>
            
                <li><a href="../classes/Sortable.html">Sortable</a></li>
            
                <li><a href="../classes/Store.html">Store</a></li>
            
                <li><a href="../classes/Style.html">Style</a></li>
            
                <li><a href="../classes/Task.html">Task</a></li>
            
                <li><a href="../classes/Utils.html">Utils</a></li>
            
                <li><a href="../classes/View.html">View</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/mokit.html">mokit</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/event.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * 事件模块
 * @class Event
 * @module mokit
 */
(function(owner) {
    &quot;require:nomunge,exports:nomunge,module:nomunge&quot;;
    &quot;use strict&quot;;

    /** 
     * 为对象定义一个事件
     * @method create
     * @param  {Object} src      要添加事件的对象
     * @param  {String} name     事件名称
     * @param  {BindType} bindType 事件绑定类型
     * @return {Event}           定义的事件
     * @static
     */
    owner.create = function(src, name, bindType) {
        //默认为当前对象，如果没有在一个自定义对象中使用，this指向的是window
        var me = this;
        //默契第一个参数据事件名，第二个为对象
        if (src &amp;&amp; owner.utils.isString(name)) me = src;
        //为了支持第一个参数为对象，第二个参为事件名的写法
        if (name &amp;&amp; owner.utils.isString(src)) {
            me = name;
            name = src;
        }
        //事件存放列表
        if (!me._eventList) me._eventList = {};
        //如果事件不存则添加
        if (!me._eventList[name]) {
            me._eventList[name] = [];
            //用以支持系统对象的系统事件
            me.addEventListener = me.addEventListener || function(name, fn, useCapture) {
                if (me.attachEvent) me.attachEvent(&quot;on&quot; + name, fn);
            };
            me.removeEventListener = me.removeEventListener || function(name, fn, useCapture) {
                if (me.detachEvent) me.detachEvent(&quot;on&quot; + name, fn);
            };
            //处理绑定类型
            if (bindType == null &amp;&amp; bindType != 0) {
                if (owner.utils.isArray(me) &amp;&amp; !owner.utils.isElement(me)) bindType = owner.bindType.child;
                else bindType = owner.bindType.self;
            }
            //实现对数组批量支持(支持数组及伪数组),迭代器
            me._each = function(fn, _bindType) {
                    if (owner.utils.isArray(me) &amp;&amp; !owner.utils.isElement(me) &amp;&amp; owner.bindType.self != _bindType &amp;&amp; me[0]) {
                        owner.utils.each(me, fn);
                    }
                    return me;
                }
                //如果指定的事件已经定义过，则将原有定义转存$+name形式备用
            if (me[name]) me[&quot;$&quot; + name] = me[name];
            /**
             * 添加一个事件处理或触事件
             * @param  {Function} fn  事件处理函数
             * @param  {Object}   obj 处理函数据的作用域对象
             * @return {void}         无返回值
             */
            me[name] = function(fn, obj) {
                if (fn &amp;&amp; owner.utils.isFunction(fn)) me[name].bind(fn, obj);
                else me[name].trigger.apply(me[name], arguments);
                return me;
            };
            /**
             * 清空事件处理函数
             * @return {void} 无返回值
             */
            me[name].clear = function() {
                //如果是数组或伪数组
                me._each(function() {
                    owner.create(name, this).clear();
                }, bindType);
                //
                me._eventList[name] = [];
                return me;
            };
            /**
             * 验证一个处理函数是否已经添加
             * @param  {Function} fn 处理函数
             * @return {Boolean}     Bool值
             */
            me[name].has = function(fn) {
                var list = me._eventList[name];
                for (var i = 0; i &lt; list.length; i++) {
                    if (list[i] == fn) return true;
                }
            };
            /**
             * 添加（绑定）一个事件处理函数
             * @param  {Function} fn  处理函数
             * @param  {Object}   obj 处理函数作用对象
             * @return {void}         无运回值
             */
            me[name].add = me[name].bind = function(fn, obj) {
                //如果是数组或伪数组
                me._each(function() {
                    owner.create(name, this).add(fn, obj);
                }, bindType);
                //
                if (me[name].has(fn) || owner.bindType.child == bindType) return me;
                fn._src = obj;
                me._eventList[name].push(fn);
                //如果为系统对象支持系统事件
                if (me.addEventListener &amp;&amp; me.removeEventListener) {
                    fn.$invoke = function(event) {
                        var rs = fn.apply(me, arguments);
                        if (rs === false) { //阻止事件冒泡
                            if (event.cancelBubble) event.cancelBubble = true;
                            if (event.preventDefault) event.preventDefault();
                            if (event.stopPropagation) event.stopPropagation();
                        }
                    }
                    me.addEventListener(name, fn.$invoke, false);
                }
                return me;
            };
            /**
             * 移除（解绑）一个事件处理函数
             * @param  {Function} fn 处理函数
             * @return {void}     无返回值
             */
            me[name].remove = me[name].unbind = function(fn) {
                //如果是数组或伪数组
                me._each(function() {
                    owner.create(name, this).remove(fn);
                }, bindType);
                //
                if (owner.bindType.child == bindType) return me;
                //
                if (me.addEventListener &amp;&amp; me.removeEventListener) {
                    me.removeEventListener(name, fn.$invoke);
                }
                //
                var newEventList = [];
                owner.utils.each(me._eventList[name], function(i, item) {
                    if (item != fn) {
                        newEventList.push(item);
                    }
                });
                me._eventList[name] = newEventList;
                return me;
            };
            /*
             * 触发一个事件
             * @return {void} 无返回值
             */
            me[name].trigger = me[name].fire = function() {
                /// &lt;summary&gt;触发&lt;/summary&gt;
                var args = arguments;
                //如果是数组或伪数组
                me._each(function() {
                    owner.create(name, this).trigger.apply(this[name], args);
                }, bindType);
                //  
                if (me[&quot;$&quot; + name]) {
                    me[&quot;$&quot; + name].apply(me, args);
                    return;
                }
                //
                owner.utils.each(me._eventList[name], function(i, item) {
                    if (me._eventList[name][i] != null) {
                        var src = me._eventList[name][i]._src;
                        if (src == null) src = me;
                        if (src) me._eventList[name][i].apply(src, args);
                    }
                });
                return me;
            };
        }
        //返回事件
        return me[name];
    };

    /**
     * 事件绑定类型
     * @property {enum} bindType
     */
    owner.bindType = {
        self: 0,
        child: 1,
        all: 2
    };

    //兼容AMD模块
    if (typeof define === &#x27;function&#x27; &amp;&amp; define.amd) {
        define(&#x27;$event&#x27;, &#x27;utils&#x27;, function(utils) {
            owner.utils = utils;
            return owner;
        });
    } else {
        owner.utils = $utils;
    }

})((typeof exports === &#x27;undefined&#x27;) ? (window.$event = {}) : exports);
//
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
